<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>è¡¨ç™½å¢™ - æ ¡å›­ç»¼åˆæœåŠ¡å¹³å°</title>
  <link rel="stylesheet" href="{% static 'css/common.css' %}" />
  <link rel="stylesheet" href="{% static 'css/animations.css' %}" />
  <link rel="stylesheet" href="{% static 'css/confess-css.css' %}" />
  <link rel="stylesheet" href="{% static 'css/decorations.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="confess">

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<div class="page-loader">
  <div class="loader-content">
    <div class="loader"></div>
    <p class="fade-in">åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</p>
  </div>
</div>

<!-- æ»šåŠ¨è¿›åº¦æ¡ -->
<div class="scroll-progress"></div>

<!-- è£…é¥°èƒŒæ™¯ -->
<div class="flowing-background">
  <div class="decorative-line"></div>
  <div class="decorative-line"></div>
  <div class="decorative-line"></div>
  <div class="decorative-line"></div>
  <div class="decorative-shape"></div>
  <div class="decorative-shape"></div>
  <div class="decorative-shape"></div>
  <img src="{% static 'images/book-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
  <img src="{% static 'images/chat-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
  <img src="{% static 'images/heart-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
  <!-- æ·»åŠ 20ä¸ªè£…é¥°ç‚¹ -->
  {% for i in "12345678901234567890" %}
  <div class="decorative-dot"></div>
  {% endfor %}
  <div class="wave"></div>
  <div class="wave"></div>
</div>

<!-- æ–°å¢æµåŠ¨æ•ˆæœå…ƒç´  -->
<div class="particle-system">
  <div class="particle"></div>
  <div class="particle"></div>
  <div class="particle"></div>
  <div class="particle"></div>
  <div class="particle"></div>
</div>

<div class="flow-line"></div>
<div class="flow-line"></div>
<div class="flow-line"></div>
<div class="flow-line"></div>
<div class="flow-line"></div>

<div class="glow-spot"></div>
<div class="glow-spot"></div>
<div class="glow-spot"></div>
<div class="glow-spot"></div>
<div class="glow-spot"></div>

<div class="ripple-ring"></div>
<div class="ripple-ring"></div>
<div class="ripple-ring"></div>
<div class="ripple-ring"></div>

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header>
  <div class="navbar">
    <div class="nav-links">
      <ul>
        <li><a href="{% url 'homepage:homepage' %}">é¦–é¡µ</a></li>
        <li><a href="{% url 'activities:activities' %}">ç¤¾å›¢æ´»åŠ¨</a></li>
        <li><a href="{% url 'materials:materials'%}">è¯¾ä»¶å…±äº«</a></li>
        <li><a href="{% url 'forum:forum' %}">è®ºå›</a></li>
        <li><a href="{% url 'confess:confess' %}" class="active">è¡¨ç™½å¢™</a></li>
        <li><a href="{% url 'lostfound:lost_found_page' %}">å¤±ç‰©æ‹›é¢†</a></li>
        <!-- äºŒæ‰‹å¸‚åœºåŠŸèƒ½æš‚æ—¶éšè— -->
        <li><a href="{% url 'news:news' %}">æ ¡å›­ç«æ¦œ</a></li>
      </ul>
    </div>
    <div class="user-area">
      <a href="{% url 'users:logout' %}" class="logout">é€€å‡ºç™»å½•</a>
      <!-- å½“å‰å¤´åƒ -->
      {% if user.avatar %}
      <img id="current-avatar" src="{{ user.avatar.url }}" class="avatar-circle hover-scale" alt="å¤´åƒ" onerror="this.src='/media/default_avatars/1.jpg'">
      {% elif user.default_avatar %}
      <img id="current-avatar" src="/media/{{ user.default_avatar }}" class="avatar-circle hover-scale" alt="é»˜è®¤å¤´åƒ" onerror="this.src='/media/default_avatars/1.jpg'">
      {% else %}
      <img id="current-avatar" src="/media/default_avatars/1.jpg" class="avatar-circle hover-scale" alt="é»˜è®¤å¤´åƒ">
      {% endif %}

      <!-- å¤´åƒé€‰æ‹©å¼¹çª— -->
      <div id="avatar-selector" class="avatar-selector hidden">
        <h3 class="avatar-selector-title">é€‰æ‹©å¤´åƒ</h3>
        <div class="avatar-grid">
          <!-- é»˜è®¤å¤´åƒåˆ—è¡¨ -->
          {% for i in avatar_range %}
          <img src="/media/default_avatars/{{ i }}.jpg" class="avatar-option hover-scale" data-path="default_avatars/{{ i }}.jpg">
          {% endfor %}
        </div>
        <!-- è‡ªå®šä¹‰å¤´åƒä¸Šä¼  -->
        <form method="post" enctype="multipart/form-data" action="{% url 'homepage:upload_avatar' %}">
          {% csrf_token %}
          <label class="custom-upload hover-lift">
            <i class="fas fa-upload"></i> ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ
            <input type="file" name="avatar" accept="image/*">
          </label>
        </form>
      </div>
    </div>
  </div>
</header>

<div class="main-container">
  <!-- è‹±é›„åŒºåŸŸ -->
  <section class="hero gradient-animation">
    <div class="hero-content">
      <h1 class="fade-in-down">â¤ï¸ è¡¨ç™½å¢™</h1>
      <p class="typing-text fade-in-up delay-300" data-speed="80" data-delay="500">åœ¨è¿™é‡Œå¤§å£°çš„è¯´å‡ºä½ å¿ƒçˆ±çš„å¯¹è±¡å§!</p>
      <div class="hero-cta fade-in delay-600">
        <a href="#" id="show-confess-form" class="btn btn-primary hover-lift">å‘å¸ƒè¡¨ç™½</a>
      </div>
    </div>
    <div class="hero-shapes">
      <div class="hero-shape shape1 float"></div>
      <div class="hero-shape shape2 float-strong delay-200"></div>
      <div class="hero-shape shape3 float delay-400"></div>
    </div>
    <!-- æ¼‚æµ®çš„çˆ±å¿ƒè£…é¥° -->
    <div class="floating-hearts">
      <div class="heart heart1"></div>
      <div class="heart heart2"></div>
      <div class="heart heart3"></div>
      <div class="heart heart4"></div>
      <div class="heart heart5"></div>
    </div>
  </section>

  <!-- è¡¨ç™½åˆ—è¡¨åŒºåŸŸ -->
  <section class="confess-posts reveal reveal-up delay-200">
    <div class="confess-header">
      <div class="header-left">
        <h2 class="section-title">è¡¨ç™½åˆ—è¡¨</h2>
        <div class="section-line"></div>
      </div>
    </div>

    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="confess-background">
      <div class="bg-line line1"></div>
      <div class="bg-line line2"></div>
      <div class="bg-line line3"></div>
      <div class="bg-line line4"></div>
      <div class="bg-heart heart1"></div>
      <div class="bg-heart heart2"></div>
      <div class="bg-heart heart3"></div>
      <!-- æ·»åŠ æµåŠ¨çš„çˆ±å¿ƒ -->
      <div class="floating-bg-heart"></div>
      <div class="floating-bg-heart"></div>
      <div class="floating-bg-heart"></div>
      <div class="floating-bg-heart"></div>
      <div class="floating-bg-heart"></div>
      <div class="floating-bg-heart"></div>
      <!-- æ·»åŠ è£…é¥°æ€§æ˜Ÿæ˜Ÿ -->
      <div class="bg-star"></div>
      <div class="bg-star"></div>
      <div class="bg-star"></div>
      <!-- æ·»åŠ è£…é¥°æ€§åœ†ç‚¹ -->
      <div class="bg-dot"></div>
      <div class="bg-dot"></div>
      <div class="bg-dot"></div>
      <div class="bg-dot"></div>
    </div>

    <!-- æœç´¢æ¡†ç§»åŠ¨åˆ°è¿™é‡Œ -->
    <div class="confess-search-container">
      <form method="get" action="{% url 'confess:search_confessions' %}" class="confess-search">
        <input type="text" name="q" placeholder="æœç´¢è¡¨ç™½..." value="{{ query }}">
        <button type="submit" class="btn btn-secondary hover-lift">æœç´¢</button>
      </form>
    </div>

    <div class="confess-grid">
      {% for confession in confessions %}
      <article class="confess-card reveal reveal-left chain-item hover-lift">
        <div class="confess-content">
          <div class="confess-header-card">
            <div class="confess-avatar">
              {% if confession.is_anonymous %}
                <div class="anonymous-avatar">åŒ¿</div>
              {% elif confession.author.avatar %}
                <img src="{{ confession.author.avatar.url }}" alt="å¤´åƒ">
              {% elif confession.author.default_avatar %}
                <img src="/media/{{ confession.author.default_avatar }}" alt="å¤´åƒ">
              {% else %}
                <img src="/media/default_avatars/1.jpg" alt="å¤´åƒ">
              {% endif %}
            </div>
            <h3 class="confess-title">
              {% if confession.is_anonymous %}
                åŒ¿å
              {% else %}
                {{ confession.display_author }}
              {% endif %}
               <span class="confess-arrow">â¤</span> {{ confession.to_whom }}
            </h3>
          </div>
          <p class="confess-text">{{ confession.content }}</p>
          <div class="confess-footer">
            <div class="confess-meta">
              <span class="confess-date">{{ confession.created_at|date:"Y-m-d H:i" }}</span>
            </div>
            <div class="confess-actions">
              <a href="{% url 'confess:vote_confession' confession.id 'like' %}" class="btn-vote like-btn {% if user in confession.liked_users %}active{% endif %}">
                <span class="vote-icon">â¤ï¸</span>
                <span class="vote-count">{{ confession.likes }}</span>
              </a>
              <a href="{% url 'confess:vote_confession' confession.id 'dislike' %}" class="btn-vote dislike-btn {% if user in confession.disliked_users %}active{% endif %}">
                <span class="vote-icon">ğŸ’”</span>
                <span class="vote-count">{{ confession.dislikes }}</span>
              </a>
            </div>
          </div>
        </div>
      </article>
      {% empty %}
      <div class="no-confessions">æš‚æ— è¡¨ç™½ï¼Œèµ¶å¿«å‘å¸ƒç¬¬ä¸€æ¡å§ï¼</div>
      {% endfor %}
    </div>
  </section>
</div>

<!-- é—´éš”åŒºåŸŸ -->
<div class="spacer"></div>

<!-- å‘è¡¨ç™½å¼¹çª— -->
<div class="overlay" id="confess-form-overlay">
  <div class="popup" id="confess-form-popup">
    <span class="close-btn" id="close-confess-form">&times;</span>
    <div class="modal-content">
      <h2 class="section-title">â¤ï¸ å‘å¸ƒè¡¨ç™½</h2>
      <div class="section-line"></div>
      <form id="confessForm" method="POST" action="{% url 'confess:create_confession' %}">
        {% csrf_token %}
        <div class="form-group author-name-group">
          <input type="text" name="author_name" id="author_name" placeholder="ä½ çš„æ˜µç§°" required />
        </div>
        <div class="form-group">
          <input type="text" name="target" placeholder="æƒ³è¡¨ç™½çš„äºº" required />
        </div>
        <div class="form-group">
          <textarea name="content" placeholder="è¯·è¾“å…¥ä½ çš„è¡¨ç™½å†…å®¹..." rows="5" required></textarea>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" name="is_anonymous" id="is_anonymous">
            <span>åŒ¿åè¡¨ç™½</span>
          </label>
        </div>
        <div class="confess-actions">
          <button type="submit" class="btn btn-primary hover-lift">å‘å¸ƒè¡¨ç™½</button>
          <button type="button" id="cancel-confess" class="btn btn-outline hover-lift">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<button class="scroll-to-top hover-scale">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 19V5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M5 12L12 5L19 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

<script src="{% static 'js/jquery-3.7.1.js' %}"></script>
<script src="{% static 'js/scroll-animations.js' %}"></script>
<script src="{% static 'js/avatar-handler.js' %}"></script>
<script src="{% static 'js/confess-js.js' %}"></script>

</body>
</html>
