<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>è¯¾ä»¶å…±äº«åŒº - æ ¡å›­ç»¼åˆæœåŠ¡å¹³å°</title>
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
    <link rel="stylesheet" href="{% static 'css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'css/materials-css.css' %}">
    <link rel="stylesheet" href="{% static 'css/decorations.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="materials">

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<div class="page-loader">
    <div class="loader-content">
        <div class="loader"></div>
        <p class="fade-in">åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</p>
    </div>
</div>

<!-- æ»šåŠ¨è¿›åº¦æ¡ -->
<div class="scroll-progress"></div>

<!-- è£…é¥°èƒŒæ™¯ -->
<div class="flowing-background">
    <div class="decorative-line"></div>
    <div class="decorative-line"></div>
    <div class="decorative-line"></div>
    <div class="decorative-line"></div>
    <div class="decorative-shape"></div>
    <div class="decorative-shape"></div>
    <div class="decorative-shape"></div>
    <img src="{% static 'images/book-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
    <img src="{% static 'images/chat-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
    <img src="{% static 'images/heart-logo.svg' %}" class="mini-logo" alt="è£…é¥°">
    <!-- æ·»åŠ 20ä¸ªè£…é¥°ç‚¹ -->
    {% for i in "12345678901234567890" %}
    <div class="decorative-dot"></div>
    {% endfor %}
    <div class="wave"></div>
    <div class="wave"></div>
</div>

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header>
    <div class="navbar">
        <div class="nav-links">
            <ul>
                <li><a href="{% url 'homepage:homepage' %}">é¦–é¡µ</a></li>
                <li><a href="{% url 'activities:activities' %}">ç¤¾å›¢æ´»åŠ¨</a></li>
                <li><a href="{% url 'materials:materials'%}" class="active">è¯¾ä»¶å…±äº«</a></li>
                <li><a href="{% url 'forum:forum' %}">è®ºå›</a></li>
                <li><a href="{% url 'confess:confess' %}">è¡¨ç™½å¢™</a></li>
                <li><a href="{% url 'lostfound:lost_found_page' %}">å¤±ç‰©æ‹›é¢†</a></li>
                <!-- äºŒæ‰‹å¸‚åœºåŠŸèƒ½æš‚æ—¶éšè— -->
                <li><a href="{% url 'news:news' %}">æ ¡å›­ç«æ¦œ</a></li>
            </ul>
        </div>
        <div class="user-area">
            <a href="{% url 'users:logout' %}" class="logout">é€€å‡ºç™»å½•</a>
            <!-- å½“å‰å¤´åƒ -->
            {% if user.avatar %}
            <img id="current-avatar" src="{{ user.avatar.url }}" class="avatar-circle hover-scale" alt="å¤´åƒ" onerror="this.src='/media/default_avatars/1.jpg'">
            {% elif user.default_avatar %}
            <img id="current-avatar" src="/media/{{ user.default_avatar }}" class="avatar-circle hover-scale" alt="é»˜è®¤å¤´åƒ" onerror="this.src='/media/default_avatars/1.jpg'">
            {% else %}
            <img id="current-avatar" src="/media/default_avatars/1.jpg" class="avatar-circle hover-scale" alt="é»˜è®¤å¤´åƒ">
            {% endif %}

            <!-- å¤´åƒé€‰æ‹©å¼¹çª— -->
            <div id="avatar-selector" class="avatar-selector hidden">
                <h3 class="avatar-selector-title">é€‰æ‹©å¤´åƒ</h3>
                <div class="avatar-grid">
                    <!-- é»˜è®¤å¤´åƒåˆ—è¡¨ -->
                    {% for i in avatar_range %}
                    <img src="/media/default_avatars/{{ i }}.jpg" class="avatar-option hover-scale" data-path="default_avatars/{{ i }}.jpg">
                    {% endfor %}
                </div>
                <!-- è‡ªå®šä¹‰å¤´åƒä¸Šä¼  -->
                <form method="post" enctype="multipart/form-data" action="{% url 'homepage:upload_avatar' %}">
                    {% csrf_token %}
                    <label class="custom-upload hover-lift">
                        <i class="fas fa-upload"></i> ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ
                        <input type="file" name="avatar" accept="image/*" onchange="this.form.submit()">
                    </label>
                </form>
            </div>
        </div>
    </div>
</header>

<!-- è‹±é›„åŒºåŸŸ -->
<section class="hero gradient-animation">
    <div class="hero-content">
        <h1 class="fade-in-down">è¯¾ä»¶å…±äº«åŒº</h1>
        <p class="typing-text fade-in-up delay-300" data-speed="80" data-delay="500">ä¸Šä¼ è¯¾ä»¶ã€å…±äº«çŸ¥è¯†ã€åŠ©åŠ›å­¦ä¹ </p>
        <div class="hero-cta fade-in delay-600">
            <a href="#" id="show-upload-form" class="btn btn-outline hover-lift">ä¸Šä¼ è¯¾ä»¶</a>
        </div>
    </div>
    <div class="hero-shapes">
        <div class="hero-shape shape1 float"></div>
        <div class="hero-shape shape2 float-strong delay-200"></div>
        <div class="hero-shape shape3 float delay-400"></div>
    </div>
</section>

<!-- è¯¾ä»¶åˆ—è¡¨åŒºåŸŸ -->
<section class="materials-list reveal reveal-up delay-200">
    <div class="materials-header">
        <h2 class="section-title">è¯¾ä»¶åˆ—è¡¨</h2>
        <div class="section-line"></div>
        <div class="materials-search">
            <input type="text" id="materials-search-input" placeholder="æœç´¢è¯¾ä»¶...">
            <button id="materials-search-btn" class="btn btn-secondary hover-lift">æœç´¢</button>
        </div>
    </div>

    <div class="materials-grid">
        {% for material in materials %}
        <article class="material-card reveal reveal-left chain-item hover-lift" data-material-id="{{ material.id }}">
            <div class="material-icon-container">
                <!-- æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒå›¾æ ‡ -->
                <div class="file-icon file-icon-{{ material.file.url|slice:"-3:" }}">
                    {% if material.file.url|slice:"-3:" == "pdf" %}
                    <img src="{% static 'images/pdf-icon.svg' %}" alt="PDFæ–‡ä»¶">
                    {% elif material.file.url|slice:"-3:" == "doc" or material.file.url|slice:"-4:" == "docx" %}
                    <img src="{% static 'images/doc-icon.svg' %}" alt="Wordæ–‡ä»¶">
                    {% elif material.file.url|slice:"-2:" == "md" %}
                    <img src="{% static 'images/md-icon.svg' %}" alt="Markdownæ–‡ä»¶">
                    {% elif material.file.url|slice:"-3:" == "jpg" or material.file.url|slice:"-3:" == "png" or material.file.url|slice:"-4:" == "jpeg" %}
                    <img src="{% static 'images/img-icon.svg' %}" alt="å›¾ç‰‡æ–‡ä»¶">
                    {% else %}
                    <img src="{% static 'images/file-icon.svg' %}" alt="ä¸€èˆ¬æ–‡ä»¶">
                    {% endif %}
                </div>
            </div>
            <div class="material-content">
                <h3 class="material-title">{{ material.title }}</h3>
                <p class="material-text">{{ material.description|truncatechars:100 }}</p>
                <div class="material-footer">
                    <div class="uploader-info">
                        {% if material.uploaded_by.avatar %}
                        <img class="uploader-avatar" src="{{ material.uploaded_by.avatar.url }}" alt="ç”¨æˆ·å¤´åƒ">
                        {% elif material.uploaded_by.default_avatar %}
                        <img class="uploader-avatar" src="/media/{{ material.uploaded_by.default_avatar }}" alt="ç”¨æˆ·å¤´åƒ">
                        {% else %}
                        <img class="uploader-avatar" src="/media/default_avatars/1.jpg" alt="ç”¨æˆ·å¤´åƒ">
                        {% endif %}
                        <span>{{ material.uploaded_by.username }}</span>
                    </div>
                    <div class="material-meta">
                        <span class="material-date">{{ material.upload_time|date:"Y-m-d H:i" }}</span>
                        <span class="download-count">ğŸ“¥ {{ material.download_count }}</span>
                    </div>
                </div>
                <div class="action-buttons">
                    {% if material.price > 0 %}
                    <button class="btn btn-primary hover-lift download-btn" data-id="{{ material.id }}" data-price="{{ material.price }}">
                        ä¸‹è½½ (Â¥{{ material.price }})
                    </button>
                    {% else %}
                    <button class="btn btn-outline hover-lift download-btn" data-id="{{ material.id }}" data-price="0">
                        å…è´¹ä¸‹è½½
                    </button>
                    {% endif %}
                </div>
            </div>
        </article>
        {% empty %}
        <div class="no-materials">æš‚æ— è¯¾ä»¶ï¼Œèµ¶å¿«ä¸Šä¼ ç¬¬ä¸€ä¸ªè¯¾ä»¶å§ï¼</div>
        {% endfor %}
    </div>
</section>

<!-- é—´éš”åŒºåŸŸ -->
<div class="spacer"></div>

<!-- ä¸Šä¼ è¯¾ä»¶å¼¹çª— -->
<div class="overlay" id="upload-form-overlay">
    <div class="popup" id="upload-form-popup">
        <span class="close-btn" id="close-upload-form">&times;</span>
        <div class="modal-content">
            <h2 class="section-title">ğŸ“š ä¸Šä¼ è¯¾ä»¶</h2>
            <div class="section-line"></div>
            <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'materials:upload_material' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="id_title">è¯¾ä»¶æ ‡é¢˜</label>
                    {{ form.title }}
                </div>
                <div class="form-group">
                    <label for="id_description">è¯¾ä»¶ç®€ä»‹ï¼ˆé€‰å¡«ï¼‰</label>
                    {{ form.description }}
                </div>
                <div class="form-group">
                    <label for="id_price">æ”¶è´¹é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    {{ form.price }}
                </div>
                
                <!-- è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="file-upload-area">
                    <div id="fileUploadBlock">
                        <div class="file-upload-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 4V16M12 4L8 8M12 4L16 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M20 16V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <p class="upload-text">ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <p class="upload-hint">æ”¯æŒ .docã€.pdfã€.mdã€.jpgã€.png ç­‰æ ¼å¼</p>
                        {{ form.file }}
                    </div>
                    <div class="file-preview-box" id="filePreviewBox"></div>
                </div>
    
                <div class="upload-actions">
                    <button type="submit" id="upload-button" class="btn btn-primary hover-lift">ä¸Šä¼ è¯¾ä»¶</button>
                    <button type="button" id="cancel-upload" class="btn btn-outline hover-lift">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- æ”¯ä»˜å¼¹çª— -->
<div class="overlay" id="payment-overlay">
    <div class="popup" id="payment-popup">
        <span class="close-btn" id="close-payment">&times;</span>
        <div class="modal-content">
            <h2 class="section-title">ğŸ“± æ”¯ä»˜å®æ”¯ä»˜</h2>
            <div class="section-line"></div>
            <div class="payment-content">
                <div class="payment-info">
                    <p>æ‚¨æ­£åœ¨ä¸‹è½½è¯¾ä»¶ï¼š<span id="payment-material-title"></span></p>
                    <p class="payment-price">æ”¯ä»˜é‡‘é¢ï¼š<strong>Â¥<span id="payment-amount">0.00</span></strong></p>
                </div>
                <div class="payment-qrcode">
                    <div id="qrcode-container"></div>
                    <p class="qrcode-hint">è¯·ä½¿ç”¨æ”¯ä»˜å®æ‰«ç æ”¯ä»˜</p>
                </div>
                <div id="payment-actions" class="payment-actions">
                    <button id="confirm-payment" class="btn btn-primary hover-lift">æˆ‘å·²æ”¯ä»˜</button>
                    <button id="cancel-payment" class="btn btn-outline hover-lift">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<button class="scroll-to-top hover-scale">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 19V5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M5 12L12 5L19 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>

<script src="{% static 'js/jquery-3.7.1.js' %}"></script>
<script src="{% static 'js/scroll-animations.js' %}"></script>
<script src="{% static 'js/avatar-handler.js' %}"></script>
<script src="{% static 'js/materials-js.js' %}"></script>
<script>
  // é€€å‡ºç™»å½•ç¡®è®¤
  document.querySelector('.logout').addEventListener('click', function(e) {
    e.preventDefault();
    const confirmed = confirm("ç¡®å®šé€€å‡ºç™»å½•å—ï¼Ÿ");
    if (confirmed) {
      window.location.href = this.href;
    }
  });
</script>

</body>
</html>
